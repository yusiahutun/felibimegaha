<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=robots content="index,follow,noarchive"><title>Using AngleSharp in PowerShell 7 to Parse Webpages - WinkVibe</title><meta name=description content="AngleSharp is a .NET library that makes parsing and working with HTML content quick and easy. As AngleSharp is written in .NET, you can use and consume the output in PowerShell as well. Combining these two allows you to quickly and easily script HTML content. In this article, we will explore how to set up"><meta name=author content="Some Person"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"WinkVibe","url":"\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"\/using-anglesharp-in-powershell-7-to-parse-webpages.html","name":"Using angle sharp in power shell 7 to parse webpages"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Jenniffer Sheldon"},"headline":"Using AngleSharp in PowerShell 7 to Parse Webpages","description":"AngleSharp is a .NET library that makes parsing and working with HTML content quick and easy. As AngleSharp is written in .NET, you can use and consume the output in PowerShell as well. Combining these two allows you to quickly and easily script HTML content. In this article, we will explore how to set up","inLanguage":"en","wordCount":923,"datePublished":"2024-02-07T00:00:00","dateModified":"2024-02-07T00:00:00","image":"\/img\/avatar-icon.png","keywords":[""],"mainEntityOfPage":"\/using-anglesharp-in-powershell-7-to-parse-webpages.html","publisher":{"@type":"Organization","name":"\/","logo":{"@type":"ImageObject","url":"\/img\/avatar-icon.png","height":60,"width":60}}}</script><meta property="og:title" content="Using AngleSharp in PowerShell 7 to Parse Webpages"><meta property="og:description" content="AngleSharp is a .NET library that makes parsing and working with HTML content quick and easy. As AngleSharp is written in .NET, you can use and consume the output in PowerShell as well. Combining these two allows you to quickly and easily script HTML content. In this article, we will explore how to set up"><meta property="og:image" content="/img/avatar-icon.png"><meta property="og:url" content="/using-anglesharp-in-powershell-7-to-parse-webpages.html"><meta property="og:type" content="website"><meta property="og:site_name" content="WinkVibe"><meta name=twitter:title content="Using AngleSharp in PowerShell 7 to Parse Webpages"><meta name=twitter:description content="AngleSharp is a .NET library that makes parsing and working with HTML content quick and easy. As AngleSharp is written in .NET, you can use and consume the output in PowerShell as well. Combining â€¦"><meta name=twitter:image content="/img/avatar-icon.png"><meta name=twitter:card content="summary"><meta name=twitter:site content="@username"><meta name=twitter:creator content="@username"><link href=./img/favicon.ico rel=icon type=image/x-icon><meta name=generator content="Hugo 0.98.0"><link rel=alternate href=./index.xml type=application/rss+xml title=WinkVibe><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://assets.cdnweb.info/hugo/bh/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://assets.cdnweb.info/hugo/bh/css/highlight.min.css><link rel=stylesheet href=https://assets.cdnweb.info/hugo/bh/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous></head><body><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Using AngleSharp in PowerShell 7 to Parse Webpages</h1><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on February 7, 2024
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;5&nbsp;minutes
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;923&nbsp;words
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Jenniffer Sheldon</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><h3>Quick Links</h3><ul class=table-content-level-1><li><a href=#>Installing and Loading AngleSharp</a></li></ul><ul class=table-content-level-1><li><a href=#>Parsing a Webpage</a></li></ul><ul class=table-content-level-1><li><a href=#>Conclusion</a></li></ul><p><a href=#>AngleSharp</a> is a .NET library that makes parsing and working with HTML content quick and easy. As AngleSharp is written in .NET, you can use and consume the output in PowerShell as well. Combining these two allows you to quickly and easily script HTML content. In this article, we will explore how to set up AngleSharp and consume a weather page, and convert the data into a PowerShell object.</p><strong class="an-zone-tag-top ad-zone-advertising-tag"></strong> <strong class="an-zone-tag-bottom ad-zone-advertising-sub-tag"></strong><h2 id=installing-and-loading-anglesharp>Installing and Loading AngleSharp</h2><p>Installing AngleSharp is easy using the</p><pre><code class="hljs sql"><span class=hljs-keyword>Install</span>-<span class=hljs-keyword>Package</span></code> </pre><p>command. You can even install the package into the</p><pre><code class=hljs>CurrentUser</code> </pre><p>scope which means you do not need administrative rights to use this library. The package is contained in the</p><pre><code class=hljs>NuGet</code> </pre><p>library.</p><pre><code class="hljs sql"><span class=hljs-keyword>Install</span>-<span class=hljs-keyword>Package</span>&nbsp;<span class=hljs-string>'AngleSharp'</span> -<span class=hljs-keyword>Scope</span>&nbsp;<span class=hljs-string>'CurrentUser'</span> -<span class=hljs-keyword>Source</span>&nbsp;<span class=hljs-string>'Nuget'</span><br></code> </pre><p>Next we will want to load AngleSharp for use in our PowerShell script. To do this we will want to use the <code>Add-Type</code> cmdlet to directly load the DLL for the library. Below is code that assists in locating the latest .NET version and loading that path, if the library isn't already loaded in your session.</p><pre><code class="hljs php">If ( -Not ([System.Management.Automation.PSTypeName]<span class=hljs-string>'AngleSharp.Parser.Html.HtmlParser'</span>).Type ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;$standardAssemblyFullPath = (Get-ChildItem -Filter <span class=hljs-string>'*.dll'</span> -Recurse (Split-Path (Get-Package -Name <span class=hljs-string>'AngleSharp'</span>).Source)).FullName | Where-<span class=hljs-built_in>Object</span> {$_ -Like <span class=hljs-string>"*standard*"</span>} | Select-<span class=hljs-built_in>Object</span> -Last <span class=hljs-number>1</span><p>&nbsp;&nbsp;&nbsp;&nbsp;Add-Type -Path $standardAssemblyFullPath -ErrorAction <span class=hljs-string>'SilentlyContinue'</span><br>} <span class=hljs-comment># Terminate If - Not Loaded</span><br></p></code> </pre><p>Read on to discover how to parse the webpage content and create a useful PowerShell object!</p><h2 id=parsing-a-webpage>Parsing a Webpage</h2><p>Of course, the whole point of this is to actually parse a web page. In this example we will load the content from <code>Invoke-WebRequest</code> and then using the result, parse the content in AngleSharp. We are going to use a local 7-day forecast from the National Weather Service to pull in weather data and convert to an object. First, let's retrieve the weather data.</p><strong class="an-zone-tag-top ad-zone-advertising-tag"></strong> <strong class="an-zone-tag-bottom ad-zone-advertising-sub-tag"></strong><pre><code class="hljs xml">$Request = Invoke-WebRequest -Uri "<span class=hljs-tag>&lt;<span class=hljs-name>https:</span>//<span class=hljs-attr>forecast.weather.gov</span>/<span class=hljs-attr>MapClick.php</span>?<span class=hljs-attr>lat</span>=<span class=hljs-string>40.48675500000007&amp;lon</span>=<span class=hljs-string>-88.99177999999995</span>&gt;</span>"<br></code> </pre><p>The data for the site that we are interested in is in the <code>Content</code> property, but it is the full HTML source, which is a lot to process. Often, it is easiest to use Chrome Developer Tools to locate the section of the HTML source that we want to use (F12 in Chrome for the site you want to inspect).</p><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/static1.howtogeekimages.com/wordpress/wp-content/uploads/csit/2020/11/65f278a6.png><p>The HTML structure of the NWS weather page.</p><p>Thankfully, there is a <code>div</code> container with an unordered list that we can parse. The next step is to actually load the retrieved content into AngleSharp.</p><strong class="an-zone-tag-top ad-zone-advertising-tag"></strong> <strong class="an-zone-tag-bottom ad-zone-advertising-sub-tag"></strong><pre><code class="hljs php">$Parser = <span class=hljs-keyword>New</span>-Object AngleSharp.Html.Parser.HtmlParser<br>$Parsed = $Parser.ParseDocument($Request.Content)<br></code> </pre><p>Now that we have the parsed content available in our <code>$Parsed</code> variable, we can start to manipulate this data to get to just the section we want. Very conveniently, the NWS site provides an ID just for this unordered list named <code>seven-day-forecast-list</code>. Since each ID is unique on an HTML page, this makes the list easy to target. Using the <code>All</code> property on our parsed content, we can retrieve just the object with the ID of <code>seven-day-forecast-list</code>.</p><pre><code class="hljs php">$ForecastList = $Parsed.All | Where-Object ID -EQ <span class=hljs-string>'seven-day-forecast-list'</span><br></code> </pre><p>This will result in a lot of different properties, but we are focused on the <code>ChildNodes</code> property as it will contain each <code>li</code> containing the data we need. To get an idea of what we are looking to target in our object, let's take a look at an individual <code>li</code>. There are a handful of elements with classes that we can target.</p><ul><li><code>period-name</code> - The relative time period.</li><li><code>short-desc</code> - A condensed description of the weather.</li><li><code>temp temp-high</code> - The high temperature.</li></ul><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/static1.howtogeekimages.com/wordpress/wp-content/uploads/csit/2020/11/7f858d3f.png> <strong class="an-zone-tag-top ad-zone-advertising-tag"></strong> <strong class="an-zone-tag-bottom ad-zone-advertising-sub-tag"></strong><p>HTML structure of a single tombstone-container element.</p><p>You may notice that the <code>img</code> tag contains an <code>alt</code> property with a lot of useful information. It's pretty easy to find the class to target as it is stored in the <code>classname</code> property of the child node. To target the <code>alt</code> element we will have to rely on a slightly different method, <code>QuerySelectorAll</code> which uses traditional CSS selectors to make complex targeting easy.</p><pre><code class="hljs php">$ForecastList.ChildNodes | <span class=hljs-keyword>ForEach</span>-Object {<br> <span class=hljs-comment># Retrieve just the content of the tombstone-container div underneath the forecast-tombstone li element.</span><br>&nbsp;&nbsp;$Node = $_.ChildNodes | Where-Object ClassName -EQ <span class=hljs-string>'tombstone-container'</span><p>&nbsp;&nbsp;<span class=hljs-selector-attr>[PSCustomObject]</span>@{<br> <span class=hljs-comment># Search the child nodes under the tombstone-container and find the element named period-name. Retrieve just the innerHTML which is the text value. This includes a break element, </span><br>&nbsp;of which we don't need, so <span class=hljs-keyword>replace</span> that <span class=hljs-keyword>with</span> a <span class=hljs-keyword>space</span> instead.<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string>"Period"</span> = $Node.ChildNodes.Where({ $_.ClassName -EQ <span class=hljs-string>'period-name'</span>}).InnerHTML -Replace <span class=hljs-string>"</span><br><span class=hljs-string>","</span>&nbsp;<span class=hljs-string>"</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string>"Temp"</span> = $Node.ChildNodes.Where({ $_.ClassName -Match <span class=hljs-string>'temp'</span>}).InnerHTML<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string>"Short"</span> = $Node.ChildNodes.Where({ $_.ClassName -EQ <span class=hljs-string>'short-desc'</span>}).InnerHTML -Replace <span class=hljs-string>"</span><br><span class=hljs-string>","</span>&nbsp;<span class=hljs-string>"</span><br> <span class=hljs-comment># Since we don't have a class to target, on the root node, use the CSS selector p &gt; img which looks for a p element with a child img element. Next, use the Attributes property to find the one named alt and return it's value.</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string>"Alt"</span> = $Node.QuerySelectorAll(<span class=hljs-string>"p &gt; img"</span>).Attributes.Where({$_.Name -EQ <span class=hljs-string>'alt'</span>}).Value<br>&nbsp;&nbsp;}<br>}<br></p></code> </pre><img style=margin:auto;display:block;text-align:center;max-width:100%;height:auto src=https://cdn.statically.io/img/static1.howtogeekimages.com/wordpress/wp-content/uploads/csit/2020/11/8e5779e3.png><p>Output of the parsed web page from AngleSharp.</p><strong class="an-zone-tag-top ad-zone-advertising-tag"></strong> <strong class="an-zone-tag-bottom ad-zone-advertising-sub-tag"></strong><p>Although we have to iterate over a few elements to ultimately get to just the ones we want, we can walk through the HTML document structure and get to just what we need. It can be a bit tricky to understand the structures, but ultimately what AngleSharp is doing is creating objects for each DOM element. Once you figure out the best way to target the elements you need, extracting the content is not difficult.</p><h2 id=conclusion>Conclusion</h2><p>AngleSharp offers an excellent programmatic interface to parsing and interacting with HTML content on webpages. This can open the door to using PowerShell to retrieve content that may be otherwise inaccessible. Taking this content, storing it, and using it in scripts is extremely useful and can help aid system integration methods!</p><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmivp6x7qbvWraagnZWge6S7zGibnq6fpcBwwdKipaBlkaO0rbHSoZirqF2eu268zrCcq6uYmrmteZZmq6hloJa%2FtLGMsJybqJGcsrR7</p><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=%2fusing-anglesharp-in-powershell-7-to-parse-webpages.html&text=Using%20AngleSharp%20in%20PowerShell%207%20to%20Parse%20Webpages&via=username" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=%2fusing-anglesharp-in-powershell-7-to-parse-webpages.html" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=%2fusing-anglesharp-in-powershell-7-to-parse-webpages.html&title=Using%20AngleSharp%20in%20PowerShell%207%20to%20Parse%20Webpages" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=%2fusing-anglesharp-in-powershell-7-to-parse-webpages.html&title=Using%20AngleSharp%20in%20PowerShell%207%20to%20Parse%20Webpages" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=%2fusing-anglesharp-in-powershell-7-to-parse-webpages.html&title=Using%20AngleSharp%20in%20PowerShell%207%20to%20Parse%20Webpages" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=%2fusing-anglesharp-in-powershell-7-to-parse-webpages.html&description=Using%20AngleSharp%20in%20PowerShell%207%20to%20Parse%20Webpages" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section></article><ul class="pager blog-pager"><li class=previous><a href=./who-is-etta-ng-chok-lam-jackie-chans-estranged-daughter.html data-toggle=tooltip data-placement=top title="Who Is Etta Ng Chok Lam, Jackie Chan's Estranged Daughter?">&larr; Previous Post</a></li><li class=next><a href=./microblading-before-and-after-172272.html data-toggle=tooltip data-placement=top title="Microblading Before and After Photos for Women Over 50">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted">All rights reserved
&nbsp;&bull;&nbsp;&copy;
2024
&nbsp;&bull;&nbsp;
<a href=./>WinkVibe</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.98.0</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script>
<script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=https://assets.cdnweb.info/hugo/bh/js/main.js></script>
<script src=https://assets.cdnweb.info/hugo/bh/js/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://assets.cdnweb.info/hugo/bh/js/load-photoswipe.js></script>
<script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>